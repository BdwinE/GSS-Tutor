function cov_d16zm5scn(){var path="C:\\Users\\asolu\\Desktop\\MSU_Denver\\Spring_2021\\Technical_Software_Proj\\Granular_Softwar_Solutions\\Granular%20Software%20Solutions\\services\\user\\controllers\\users.js";var hash="69171f1a5382e599bf681d9fdaa6f21407e8fad5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\asolu\\Desktop\\MSU_Denver\\Spring_2021\\Technical_Software_Proj\\Granular_Softwar_Solutions\\Granular%20Software%20Solutions\\services\\user\\controllers\\users.js",statementMap:{"0":{start:{line:1,column:25},end:{line:1,column:62}},"1":{start:{line:2,column:13},end:{line:2,column:38}},"2":{start:{line:3,column:14},end:{line:3,column:40}},"3":{start:{line:4,column:16},end:{line:4,column:44}},"4":{start:{line:5,column:23},end:{line:5,column:38}},"5":{start:{line:7,column:0},end:{line:200,column:2}},"6":{start:{line:15,column:18},end:{line:15,column:20}},"7":{start:{line:16,column:4},end:{line:43,column:5}},"8":{start:{line:17,column:18},end:{line:17,column:26}},"9":{start:{line:18,column:21},end:{line:18,column:29}},"10":{start:{line:19,column:6},end:{line:19,column:25}},"11":{start:{line:21,column:6},end:{line:27,column:7}},"12":{start:{line:22,column:32},end:{line:22,column:40}},"13":{start:{line:23,column:24},end:{line:23,column:32}},"14":{start:{line:24,column:8},end:{line:24,column:32}},"15":{start:{line:25,column:25},end:{line:25,column:65}},"16":{start:{line:26,column:8},end:{line:26,column:30}},"17":{start:{line:28,column:6},end:{line:34,column:7}},"18":{start:{line:29,column:34},end:{line:29,column:42}},"19":{start:{line:30,column:26},end:{line:30,column:34}},"20":{start:{line:31,column:8},end:{line:31,column:36}},"21":{start:{line:32,column:27},end:{line:32,column:74}},"22":{start:{line:33,column:8},end:{line:33,column:32}},"23":{start:{line:36,column:22},end:{line:36,column:40}},"24":{start:{line:38,column:24},end:{line:38,column:126}},"25":{start:{line:38,column:63},end:{line:38,column:125}},"26":{start:{line:39,column:6},end:{line:39,column:35}},"27":{start:{line:42,column:6},end:{line:42,column:23}},"28":{start:{line:44,column:4},end:{line:44,column:29}},"29":{start:{line:54,column:18},end:{line:54,column:20}},"30":{start:{line:55,column:4},end:{line:66,column:5}},"31":{start:{line:59,column:19},end:{line:60,column:43}},"32":{start:{line:62,column:6},end:{line:62,column:93}},"33":{start:{line:62,column:17},end:{line:62,column:93}},"34":{start:{line:63,column:6},end:{line:63,column:30}},"35":{start:{line:65,column:6},end:{line:65,column:23}},"36":{start:{line:68,column:4},end:{line:68,column:29}},"37":{start:{line:78,column:18},end:{line:78,column:20}},"38":{start:{line:80,column:4},end:{line:93,column:5}},"39":{start:{line:81,column:21},end:{line:81,column:31}},"40":{start:{line:83,column:19},end:{line:84,column:43}},"41":{start:{line:86,column:6},end:{line:86,column:93}},"42":{start:{line:86,column:17},end:{line:86,column:93}},"43":{start:{line:88,column:6},end:{line:88,column:22}},"44":{start:{line:92,column:6},end:{line:92,column:23}},"45":{start:{line:95,column:4},end:{line:95,column:29}},"46":{start:{line:105,column:18},end:{line:105,column:20}},"47":{start:{line:107,column:4},end:{line:162,column:5}},"48":{start:{line:108,column:21},end:{line:108,column:31}},"49":{start:{line:109,column:38},end:{line:109,column:46}},"50":{start:{line:111,column:22},end:{line:111,column:24}},"51":{start:{line:113,column:6},end:{line:113,column:53}},"52":{start:{line:113,column:23},end:{line:113,column:53}},"53":{start:{line:114,column:6},end:{line:114,column:50}},"54":{start:{line:114,column:22},end:{line:114,column:50}},"55":{start:{line:116,column:19},end:{line:116,column:42}},"56":{start:{line:118,column:6},end:{line:118,column:93}},"57":{start:{line:118,column:17},end:{line:118,column:93}},"58":{start:{line:120,column:6},end:{line:135,column:7}},"59":{start:{line:121,column:32},end:{line:121,column:40}},"60":{start:{line:122,column:22},end:{line:122,column:32}},"61":{start:{line:123,column:8},end:{line:134,column:9}},"62":{start:{line:124,column:10},end:{line:124,column:28}},"63":{start:{line:125,column:27},end:{line:125,column:67}},"64":{start:{line:126,column:10},end:{line:126,column:32}},"65":{start:{line:127,column:10},end:{line:127,column:34}},"66":{start:{line:130,column:31},end:{line:133,column:12}},"67":{start:{line:136,column:6},end:{line:151,column:7}},"68":{start:{line:137,column:34},end:{line:137,column:42}},"69":{start:{line:138,column:24},end:{line:138,column:36}},"70":{start:{line:139,column:8},end:{line:150,column:9}},"71":{start:{line:140,column:10},end:{line:140,column:30}},"72":{start:{line:141,column:29},end:{line:141,column:75}},"73":{start:{line:142,column:10},end:{line:142,column:34}},"74":{start:{line:143,column:10},end:{line:143,column:38}},"75":{start:{line:146,column:33},end:{line:149,column:12}},"76":{start:{line:153,column:26},end:{line:156,column:46}},"77":{start:{line:158,column:6},end:{line:158,column:36}},"78":{start:{line:161,column:6},end:{line:161,column:23}},"79":{start:{line:164,column:4},end:{line:164,column:29}},"80":{start:{line:174,column:18},end:{line:174,column:20}},"81":{start:{line:176,column:4},end:{line:196,column:5}},"82":{start:{line:177,column:21},end:{line:177,column:31}},"83":{start:{line:179,column:26},end:{line:179,column:58}},"84":{start:{line:181,column:6},end:{line:181,column:100}},"85":{start:{line:181,column:24},end:{line:181,column:100}},"86":{start:{line:183,column:6},end:{line:186,column:7}},"87":{start:{line:184,column:24},end:{line:184,column:41}},"88":{start:{line:185,column:8},end:{line:185,column:47}},"89":{start:{line:187,column:6},end:{line:190,column:7}},"90":{start:{line:188,column:26},end:{line:188,column:43}},"91":{start:{line:189,column:8},end:{line:189,column:51}},"92":{start:{line:192,column:6},end:{line:192,column:34}},"93":{start:{line:195,column:6},end:{line:195,column:23}},"94":{start:{line:198,column:4},end:{line:198,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:14,column:2},end:{line:14,column:3}},loc:{start:{line:14,column:35},end:{line:45,column:3}},line:14},"1":{name:"(anonymous_1)",decl:{start:{line:38,column:50},end:{line:38,column:51}},loc:{start:{line:38,column:63},end:{line:38,column:125}},line:38},"2":{name:"(anonymous_2)",decl:{start:{line:53,column:2},end:{line:53,column:3}},loc:{start:{line:53,column:36},end:{line:69,column:3}},line:53},"3":{name:"(anonymous_3)",decl:{start:{line:77,column:2},end:{line:77,column:3}},loc:{start:{line:77,column:32},end:{line:96,column:3}},line:77},"4":{name:"(anonymous_4)",decl:{start:{line:104,column:2},end:{line:104,column:3}},loc:{start:{line:104,column:35},end:{line:165,column:3}},line:104},"5":{name:"(anonymous_5)",decl:{start:{line:173,column:2},end:{line:173,column:3}},loc:{start:{line:173,column:35},end:{line:199,column:3}},line:173}},branchMap:{"0":{loc:{start:{line:21,column:6},end:{line:27,column:7}},type:"if",locations:[{start:{line:21,column:6},end:{line:27,column:7}},{start:{line:21,column:6},end:{line:27,column:7}}],line:21},"1":{loc:{start:{line:28,column:6},end:{line:34,column:7}},type:"if",locations:[{start:{line:28,column:6},end:{line:34,column:7}},{start:{line:28,column:6},end:{line:34,column:7}}],line:28},"2":{loc:{start:{line:62,column:6},end:{line:62,column:93}},type:"if",locations:[{start:{line:62,column:6},end:{line:62,column:93}},{start:{line:62,column:6},end:{line:62,column:93}}],line:62},"3":{loc:{start:{line:86,column:6},end:{line:86,column:93}},type:"if",locations:[{start:{line:86,column:6},end:{line:86,column:93}},{start:{line:86,column:6},end:{line:86,column:93}}],line:86},"4":{loc:{start:{line:113,column:6},end:{line:113,column:53}},type:"if",locations:[{start:{line:113,column:6},end:{line:113,column:53}},{start:{line:113,column:6},end:{line:113,column:53}}],line:113},"5":{loc:{start:{line:114,column:6},end:{line:114,column:50}},type:"if",locations:[{start:{line:114,column:6},end:{line:114,column:50}},{start:{line:114,column:6},end:{line:114,column:50}}],line:114},"6":{loc:{start:{line:118,column:6},end:{line:118,column:93}},type:"if",locations:[{start:{line:118,column:6},end:{line:118,column:93}},{start:{line:118,column:6},end:{line:118,column:93}}],line:118},"7":{loc:{start:{line:120,column:6},end:{line:135,column:7}},type:"if",locations:[{start:{line:120,column:6},end:{line:135,column:7}},{start:{line:120,column:6},end:{line:135,column:7}}],line:120},"8":{loc:{start:{line:123,column:8},end:{line:134,column:9}},type:"if",locations:[{start:{line:123,column:8},end:{line:134,column:9}},{start:{line:123,column:8},end:{line:134,column:9}}],line:123},"9":{loc:{start:{line:136,column:6},end:{line:151,column:7}},type:"if",locations:[{start:{line:136,column:6},end:{line:151,column:7}},{start:{line:136,column:6},end:{line:151,column:7}}],line:136},"10":{loc:{start:{line:139,column:8},end:{line:150,column:9}},type:"if",locations:[{start:{line:139,column:8},end:{line:150,column:9}},{start:{line:139,column:8},end:{line:150,column:9}}],line:139},"11":{loc:{start:{line:181,column:6},end:{line:181,column:100}},type:"if",locations:[{start:{line:181,column:6},end:{line:181,column:100}},{start:{line:181,column:6},end:{line:181,column:100}}],line:181},"12":{loc:{start:{line:183,column:6},end:{line:186,column:7}},type:"if",locations:[{start:{line:183,column:6},end:{line:186,column:7}},{start:{line:183,column:6},end:{line:186,column:7}}],line:183},"13":{loc:{start:{line:187,column:6},end:{line:190,column:7}},type:"if",locations:[{start:{line:187,column:6},end:{line:190,column:7}},{start:{line:187,column:6},end:{line:190,column:7}}],line:187}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"69171f1a5382e599bf681d9fdaa6f21407e8fad5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_d16zm5scn=function(){return actualCoverage;};}return actualCoverage;}cov_d16zm5scn();const ApplicationError=(cov_d16zm5scn().s[0]++,require('../config/ApplicationError'));const User=(cov_d16zm5scn().s[1]++,require('../models/User'));const Tutor=(cov_d16zm5scn().s[2]++,require('../models/Tutor'));const Student=(cov_d16zm5scn().s[3]++,require('../models/Student'));const{v4:uuidv4}=(cov_d16zm5scn().s[4]++,require('uuid'));cov_d16zm5scn().s[5]++;module.exports={/**
   * Create new user and save to database.
   *
   * @param {Request} req
   * @param {Response} res
   */async createUser(req,res,next){cov_d16zm5scn().f[0]++;let payload=(cov_d16zm5scn().s[6]++,{});cov_d16zm5scn().s[7]++;try{const _id=(cov_d16zm5scn().s[8]++,uuidv4());let userInfo=(cov_d16zm5scn().s[9]++,req.body);cov_d16zm5scn().s[10]++;userInfo._id=_id;cov_d16zm5scn().s[11]++;if(req.body.hasOwnProperty('tutorSpecific')){cov_d16zm5scn().b[0][0]++;const{tutorSpecific}=(cov_d16zm5scn().s[12]++,req.body);const tutorId=(cov_d16zm5scn().s[13]++,uuidv4());cov_d16zm5scn().s[14]++;userInfo.tutor=tutorId;const newTutor=(cov_d16zm5scn().s[15]++,new Tutor({_id:tutorId,tutorSpecific}));cov_d16zm5scn().s[16]++;await newTutor.save();}else{cov_d16zm5scn().b[0][1]++;}cov_d16zm5scn().s[17]++;if(req.body.hasOwnProperty('studentSpecific')){cov_d16zm5scn().b[1][0]++;const{studentSpecific}=(cov_d16zm5scn().s[18]++,req.body);const studentId=(cov_d16zm5scn().s[19]++,uuidv4());cov_d16zm5scn().s[20]++;userInfo.student=studentId;const newStudent=(cov_d16zm5scn().s[21]++,new Student({_id:studentId,studentSpecific}));cov_d16zm5scn().s[22]++;await newStudent.save();}else{cov_d16zm5scn().b[1][1]++;}const newUser=(cov_d16zm5scn().s[23]++,new User(userInfo));const savedUser=(cov_d16zm5scn().s[24]++,await newUser.save().then(savedUser=>{cov_d16zm5scn().f[1]++;cov_d16zm5scn().s[25]++;return savedUser.populate('tutor').populate("student").execPopulate();}));cov_d16zm5scn().s[26]++;payload={user:savedUser};}catch(err){cov_d16zm5scn().s[27]++;return next(err);}cov_d16zm5scn().s[28]++;return res.json(payload);},/**
   * Get all user from database all avaible user services.
   *
   * @param {Request} req
   * @param {Response} res
   */async getAllUsers(req,res,next){cov_d16zm5scn().f[2]++;let payload=(cov_d16zm5scn().s[29]++,{});cov_d16zm5scn().s[30]++;try{//const { id } = req.params;
const user=(cov_d16zm5scn().s[31]++,await User.find().populate("tutor").populate("student"));cov_d16zm5scn().s[32]++;if(!user){cov_d16zm5scn().b[2][0]++;cov_d16zm5scn().s[33]++;throw new ApplicationError({message:'User not found.',statusCode:404});}else{cov_d16zm5scn().b[2][1]++;}cov_d16zm5scn().s[34]++;payload={users:user};}catch(err){cov_d16zm5scn().s[35]++;return next(err);}cov_d16zm5scn().s[36]++;return res.json(payload);},/**
   * Get a user from the database by id.
   *
   * @param {Request} req
   * @param {Response} res
   */async getUser(req,res,next){cov_d16zm5scn().f[3]++;let payload=(cov_d16zm5scn().s[37]++,{});cov_d16zm5scn().s[38]++;try{const{id}=(cov_d16zm5scn().s[39]++,req.params);const user=(cov_d16zm5scn().s[40]++,await User.findById(id).populate("tutor").populate("student"));cov_d16zm5scn().s[41]++;if(!user){cov_d16zm5scn().b[3][0]++;cov_d16zm5scn().s[42]++;throw new ApplicationError({message:'User not found.',statusCode:404});}else{cov_d16zm5scn().b[3][1]++;}cov_d16zm5scn().s[43]++;payload={user};}catch(err){cov_d16zm5scn().s[44]++;//console.log(err)
return next(err);}cov_d16zm5scn().s[45]++;return res.json(payload);},/**
   * Update a user in the database by id.
   *
   * @param {Request} req
   * @param {Response} res
   */async updateUser(req,res,next){cov_d16zm5scn().f[4]++;let payload=(cov_d16zm5scn().s[46]++,{});cov_d16zm5scn().s[47]++;try{const{id}=(cov_d16zm5scn().s[48]++,req.params);const{firstName,lastName}=(cov_d16zm5scn().s[49]++,req.body);const updates=(cov_d16zm5scn().s[50]++,{});cov_d16zm5scn().s[51]++;if(!!firstName){cov_d16zm5scn().b[4][0]++;cov_d16zm5scn().s[52]++;updates.firstName=firstName;}else{cov_d16zm5scn().b[4][1]++;}cov_d16zm5scn().s[53]++;if(!!lastName){cov_d16zm5scn().b[5][0]++;cov_d16zm5scn().s[54]++;updates.lastName=lastName;}else{cov_d16zm5scn().b[5][1]++;}const user=(cov_d16zm5scn().s[55]++,await User.findById(id));cov_d16zm5scn().s[56]++;if(!user){cov_d16zm5scn().b[6][0]++;cov_d16zm5scn().s[57]++;throw new ApplicationError({message:'User not found.',statusCode:404});}else{cov_d16zm5scn().b[6][1]++;}cov_d16zm5scn().s[58]++;if(req.body.hasOwnProperty('tutorSpecific')){cov_d16zm5scn().b[7][0]++;const{tutorSpecific}=(cov_d16zm5scn().s[59]++,req.body);let tutorId=(cov_d16zm5scn().s[60]++,user.tutor);cov_d16zm5scn().s[61]++;if(!tutorId){cov_d16zm5scn().b[8][0]++;cov_d16zm5scn().s[62]++;//new tutor
tutorId=uuidv4();const newTutor=(cov_d16zm5scn().s[63]++,new Tutor({_id:tutorId,tutorSpecific}));cov_d16zm5scn().s[64]++;await newTutor.save();cov_d16zm5scn().s[65]++;updates.tutor=tutorId;}else{cov_d16zm5scn().b[8][1]++;const updatedTutor=(cov_d16zm5scn().s[66]++,await Tutor.findByIdAndUpdate(tutorId,{tutorSpecific},{new:true,runValidators:true}));}}else{cov_d16zm5scn().b[7][1]++;}cov_d16zm5scn().s[67]++;if(req.body.hasOwnProperty('studentSpecific')){cov_d16zm5scn().b[9][0]++;const{studentSpecific}=(cov_d16zm5scn().s[68]++,req.body);let studentId=(cov_d16zm5scn().s[69]++,user.student);//contains student id
cov_d16zm5scn().s[70]++;if(!studentId){cov_d16zm5scn().b[10][0]++;cov_d16zm5scn().s[71]++;//new tutor
studentId=uuidv4();const newStudent=(cov_d16zm5scn().s[72]++,new Student({_id:studentId,studentSpecific}));cov_d16zm5scn().s[73]++;await newStudent.save();cov_d16zm5scn().s[74]++;updates.student=studentId;}else{cov_d16zm5scn().b[10][1]++;const updatedStudent=(cov_d16zm5scn().s[75]++,await Student.findByIdAndUpdate(studentId,{studentSpecific},{new:true,runValidators:true}));}}else{cov_d16zm5scn().b[9][1]++;}const updatedUser=(cov_d16zm5scn().s[76]++,await User.findByIdAndUpdate(id,updates,{new:true,runValidators:true}).populate("tutor").populate("student"));cov_d16zm5scn().s[77]++;payload={user:updatedUser};}catch(err){cov_d16zm5scn().s[78]++;//console.log(err)
return next(err);}cov_d16zm5scn().s[79]++;return res.json(payload);},/**
   * Delete a user in the database by id.
   *
   * @param {Request} req
   * @param {Response} res
   */async deleteUser(req,res,next){cov_d16zm5scn().f[5]++;let payload=(cov_d16zm5scn().s[80]++,{});cov_d16zm5scn().s[81]++;try{const{id}=(cov_d16zm5scn().s[82]++,req.params);const deletedUser=(cov_d16zm5scn().s[83]++,await User.findByIdAndDelete(id));cov_d16zm5scn().s[84]++;if(!deletedUser){cov_d16zm5scn().b[11][0]++;cov_d16zm5scn().s[85]++;throw new ApplicationError({message:'User not found.',statusCode:404});}else{cov_d16zm5scn().b[11][1]++;}cov_d16zm5scn().s[86]++;if(deletedUser.tutor){cov_d16zm5scn().b[12][0]++;const tutorId=(cov_d16zm5scn().s[87]++,deletedUser.tutor);cov_d16zm5scn().s[88]++;await Tutor.findByIdAndDelete(tutorId);}else{cov_d16zm5scn().b[12][1]++;}cov_d16zm5scn().s[89]++;if(deletedUser.student){cov_d16zm5scn().b[13][0]++;const studentId=(cov_d16zm5scn().s[90]++,deletedUser.tutor);cov_d16zm5scn().s[91]++;await Student.findByIdAndDelete(studentId);}else{cov_d16zm5scn().b[13][1]++;}cov_d16zm5scn().s[92]++;payload={success:true};}catch(err){cov_d16zm5scn().s[93]++;//console.log(err)
return next(err);}cov_d16zm5scn().s[94]++;return res.json(payload);}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sIm5hbWVzIjpbIkFwcGxpY2F0aW9uRXJyb3IiLCJyZXF1aXJlIiwiVXNlciIsIlR1dG9yIiwiU3R1ZGVudCIsInY0IiwidXVpZHY0IiwibW9kdWxlIiwiZXhwb3J0cyIsImNyZWF0ZVVzZXIiLCJyZXEiLCJyZXMiLCJuZXh0IiwicGF5bG9hZCIsIl9pZCIsInVzZXJJbmZvIiwiYm9keSIsImhhc093blByb3BlcnR5IiwidHV0b3JTcGVjaWZpYyIsInR1dG9ySWQiLCJ0dXRvciIsIm5ld1R1dG9yIiwic2F2ZSIsInN0dWRlbnRTcGVjaWZpYyIsInN0dWRlbnRJZCIsInN0dWRlbnQiLCJuZXdTdHVkZW50IiwibmV3VXNlciIsInNhdmVkVXNlciIsInRoZW4iLCJwb3B1bGF0ZSIsImV4ZWNQb3B1bGF0ZSIsInVzZXIiLCJlcnIiLCJqc29uIiwiZ2V0QWxsVXNlcnMiLCJmaW5kIiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJ1c2VycyIsImdldFVzZXIiLCJpZCIsInBhcmFtcyIsImZpbmRCeUlkIiwidXBkYXRlVXNlciIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwidXBkYXRlcyIsInVwZGF0ZWRUdXRvciIsImZpbmRCeUlkQW5kVXBkYXRlIiwibmV3IiwicnVuVmFsaWRhdG9ycyIsInVwZGF0ZWRTdHVkZW50IiwidXBkYXRlZFVzZXIiLCJkZWxldGVVc2VyIiwiZGVsZXRlZFVzZXIiLCJmaW5kQnlJZEFuZERlbGV0ZSIsInN1Y2Nlc3MiXSwibWFwcGluZ3MiOiJrZ1ZBZVk7eUZBZlosS0FBTUEsQ0FBQUEsZ0JBQWdCLHlCQUFHQyxPQUFPLENBQUMsNEJBQUQsQ0FBVixDQUF0QixDQUNBLEtBQU1DLENBQUFBLElBQUkseUJBQUdELE9BQU8sQ0FBQyxnQkFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNRSxDQUFBQSxLQUFLLHlCQUFHRixPQUFPLENBQUMsaUJBQUQsQ0FBVixDQUFYLENBQ0EsS0FBTUcsQ0FBQUEsT0FBTyx5QkFBR0gsT0FBTyxDQUFD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Q2dDLE1BQWIsQ0FBTixDQUVBLEtBQU1hLENBQUFBLFdBQVcsMEJBQUcsS0FBTXJELENBQUFBLElBQUksQ0FBQ3NELGlCQUFMLENBQXVCZixFQUF2QixDQUFULENBQWpCLENBSEUsd0JBS0YsR0FBSSxDQUFDYyxXQUFMLENBQWtCLHlEQUFNLElBQUl2RCxDQUFBQSxnQkFBSixDQUFxQixDQUFFcUMsT0FBTyxDQUFFLGlCQUFYLENBQThCQyxVQUFVLENBQUUsR0FBMUMsQ0FBckIsQ0FBTixDQUE0RSxDQUE5RixpQ0FMRSx3QkFPRixHQUFHaUIsV0FBVyxDQUFDbkMsS0FBZixDQUFxQiw0QkFDbkIsS0FBTUQsQ0FBQUEsT0FBTywwQkFBR29DLFdBQVcsQ0FBQ25DLEtBQWYsQ0FBYixDQURtQix3QkFFbkIsS0FBTWpCLENBQUFBLEtBQUssQ0FBQ3FELGlCQUFOLENBQXdCckMsT0FBeEIsQ0FBTixDQUNELENBSEQsaUNBUEUsd0JBV0YsR0FBR29DLFdBQVcsQ0FBQzlCLE9BQWYsQ0FBdUIsNEJBQ3JCLEtBQU1ELENBQUFBLFNBQVMsMEJBQUcrQixXQUFXLENBQUNuQyxLQUFmLENBQWYsQ0FEcUIsd0JBRXJCLEtBQU1oQixDQUFBQSxPQUFPLENBQUNvRCxpQkFBUixDQUEwQmhDLFNBQTFCLENBQU4sQ0FDRCxDQUhELGlDQVhFLHdCQWdCRlgsT0FBTyxDQUFHLENBQUU0QyxPQUFPLENBQUUsSUFBWCxDQUFWLENBQ0QsQ0FBQyxNQUFPeEIsR0FBUCxDQUFZLHlCQUNaO0FBQ0EsTUFBT3JCLENBQUFBLElBQUksQ0FBQ3FCLEdBQUQsQ0FBWCxDQUNELENBdkI4Qix3QkF5Qi9CLE1BQU90QixDQUFBQSxHQUFHLENBQUN1QixJQUFKLENBQVNyQixPQUFULENBQVAsQ0FDRCxDQWhNYyxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEFwcGxpY2F0aW9uRXJyb3IgPSByZXF1aXJlKCcuLi9jb25maWcvQXBwbGljYXRpb25FcnJvcicpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuY29uc3QgVHV0b3IgPSByZXF1aXJlKCcuLi9tb2RlbHMvVHV0b3InKTtcclxuY29uc3QgU3R1ZGVudCA9IHJlcXVpcmUoJy4uL21vZGVscy9TdHVkZW50Jyk7XHJcbmNvbnN0IHsgdjQ6IHV1aWR2NCB9ID0gcmVxdWlyZSgndXVpZCcpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIG5ldyB1c2VyIGFuZCBzYXZlIHRvIGRhdGFiYXNlLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtSZXF1ZXN0fSByZXFcclxuICAgKiBAcGFyYW0ge1Jlc3BvbnNlfSByZXNcclxuICAgKi9cclxuICBhc3luYyBjcmVhdGVVc2VyKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICBsZXQgcGF5bG9hZCA9IHt9O1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgX2lkID0gdXVpZHY0KCk7XHJcbiAgICAgIGxldCB1c2VySW5mbyA9IHJlcS5ib2R5O1xyXG4gICAgICB1c2VySW5mby5faWQgPSBfaWQ7XHJcblxyXG4gICAgICBpZihyZXEuYm9keS5oYXNPd25Qcm9wZXJ0eSgndHV0b3JTcGVjaWZpYycpKXtcclxuICAgICAgICBjb25zdCB7dHV0b3JTcGVjaWZpY30gPSByZXEuYm9keTtcclxuICAgICAgICBjb25zdCB0dXRvcklkID0gdXVpZHY0KClcclxuICAgICAgICB1c2VySW5mby50dXRvciA9IHR1dG9ySWRcclxuICAgICAgICBjb25zdCBuZXdUdXRvciA9IG5ldyBUdXRvcih7X2lkOiB0dXRvcklkLCB0dXRvclNwZWNpZmljfSlcclxuICAgICAgICBhd2FpdCBuZXdUdXRvci5zYXZlKCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYocmVxLmJvZHkuaGFzT3duUHJvcGVydHkoJ3N0dWRlbnRTcGVjaWZpYycpKXtcclxuICAgICAgICBjb25zdCB7c3R1ZGVudFNwZWNpZmljfSA9IHJlcS5ib2R5O1xyXG4gICAgICAgIGNvbnN0IHN0dWRlbnRJZCA9IHV1aWR2NCgpXHJcbiAgICAgICAgdXNlckluZm8uc3R1ZGVudCA9IHN0dWRlbnRJZFxyXG4gICAgICAgIGNvbnN0IG5ld1N0dWRlbnQgPSBuZXcgU3R1ZGVudCh7X2lkIDogc3R1ZGVudElkLCBzdHVkZW50U3BlY2lmaWN9KVxyXG4gICAgICAgIGF3YWl0IG5ld1N0dWRlbnQuc2F2ZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBuZXdVc2VyID0gbmV3IFVzZXIodXNlckluZm8pO1xyXG4gICAgICBcclxuICAgICAgY29uc3Qgc2F2ZWRVc2VyID0gYXdhaXQgbmV3VXNlci5zYXZlKCkudGhlbihzYXZlZFVzZXIgPT4gc2F2ZWRVc2VyLnBvcHVsYXRlKCd0dXRvcicpLnBvcHVsYXRlKFwic3R1ZGVudFwiKS5leGVjUG9wdWxhdGUoKSlcclxuICAgICAgcGF5bG9hZCA9IHt1c2VyIDogc2F2ZWRVc2VyfTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgcmV0dXJuIG5leHQoZXJyKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXMuanNvbihwYXlsb2FkKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYWxsIHVzZXIgZnJvbSBkYXRhYmFzZSBhbGwgYXZhaWJsZSB1c2VyIHNlcnZpY2VzLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtSZXF1ZXN0fSByZXFcclxuICAgKiBAcGFyYW0ge1Jlc3BvbnNlfSByZXNcclxuICAgKi9cclxuICBhc3luYyBnZXRBbGxVc2VycyhyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgbGV0IHBheWxvYWQgPSB7fTtcclxuICAgIHRyeSB7XHJcblxyXG4gICAgICAvL2NvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcblxyXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kKCkuXHJcbiAgICAgIHBvcHVsYXRlKFwidHV0b3JcIikucG9wdWxhdGUoXCJzdHVkZW50XCIpO1xyXG5cclxuICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgQXBwbGljYXRpb25FcnJvcih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZC4nLCBzdGF0dXNDb2RlOiA0MDQgfSk7XHJcbiAgICAgIHBheWxvYWQgPSB7dXNlcnMgOiB1c2VyfVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KGVycik7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlcy5qc29uKHBheWxvYWQpO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhIHVzZXIgZnJvbSB0aGUgZGF0YWJhc2UgYnkgaWQuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1JlcXVlc3R9IHJlcVxyXG4gICAqIEBwYXJhbSB7UmVzcG9uc2V9IHJlc1xyXG4gICAqL1xyXG4gIGFzeW5jIGdldFVzZXIocmVxLCByZXMsIG5leHQpIHtcclxuICAgIGxldCBwYXlsb2FkID0ge307XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGlkKS5cclxuICAgICAgcG9wdWxhdGUoXCJ0dXRvclwiKS5wb3B1bGF0ZShcInN0dWRlbnRcIik7XHJcblxyXG4gICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBBcHBsaWNhdGlvbkVycm9yKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kLicsIHN0YXR1c0NvZGU6IDQwNCB9KTtcclxuXHJcbiAgICAgIHBheWxvYWQgPSB7dXNlcn1cclxuXHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgLy9jb25zb2xlLmxvZyhlcnIpXHJcbiAgICAgIHJldHVybiBuZXh0KGVycik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuanNvbihwYXlsb2FkKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgYSB1c2VyIGluIHRoZSBkYXRhYmFzZSBieSBpZC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UmVxdWVzdH0gcmVxXHJcbiAgICogQHBhcmFtIHtSZXNwb25zZX0gcmVzXHJcbiAgICovXHJcbiAgYXN5bmMgdXBkYXRlVXNlcihyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgbGV0IHBheWxvYWQgPSB7fTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgICBjb25zdCB7IGZpcnN0TmFtZSwgbGFzdE5hbWUgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgY29uc3QgdXBkYXRlcyA9IHt9O1xyXG5cclxuICAgICAgaWYgKCEhZmlyc3ROYW1lKSB1cGRhdGVzLmZpcnN0TmFtZSA9IGZpcnN0TmFtZTtcclxuICAgICAgaWYgKCEhbGFzdE5hbWUpIHVwZGF0ZXMubGFzdE5hbWUgPSBsYXN0TmFtZTtcclxuXHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGlkKTtcclxuXHJcbiAgICAgIGlmICghdXNlcikgdGhyb3cgbmV3IEFwcGxpY2F0aW9uRXJyb3IoeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQuJywgc3RhdHVzQ29kZTogNDA0IH0pO1xyXG4gICAgICBcclxuICAgICAgaWYocmVxLmJvZHkuaGFzT3duUHJvcGVydHkoJ3R1dG9yU3BlY2lmaWMnKSl7XHJcbiAgICAgICAgY29uc3Qge3R1dG9yU3BlY2lmaWN9ID0gcmVxLmJvZHk7XHJcbiAgICAgICAgbGV0IHR1dG9ySWQgPSB1c2VyLnR1dG9yXHJcbiAgICAgICAgaWYoIXR1dG9ySWQpey8vbmV3IHR1dG9yXHJcbiAgICAgICAgICB0dXRvcklkID0gdXVpZHY0KClcclxuICAgICAgICAgIGNvbnN0IG5ld1R1dG9yID0gbmV3IFR1dG9yKHtfaWQ6IHR1dG9ySWQsIHR1dG9yU3BlY2lmaWN9KVxyXG4gICAgICAgICAgYXdhaXQgbmV3VHV0b3Iuc2F2ZSgpO1xyXG4gICAgICAgICAgdXBkYXRlcy50dXRvciA9IHR1dG9ySWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICBjb25zdCB1cGRhdGVkVHV0b3IgPSBhd2FpdCBUdXRvci5maW5kQnlJZEFuZFVwZGF0ZSh0dXRvcklkLCB7dHV0b3JTcGVjaWZpY30sIHtcclxuICAgICAgICAgICAgbmV3OiB0cnVlLFxyXG4gICAgICAgICAgICBydW5WYWxpZGF0b3JzOiB0cnVlLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmKHJlcS5ib2R5Lmhhc093blByb3BlcnR5KCdzdHVkZW50U3BlY2lmaWMnKSl7XHJcbiAgICAgICAgY29uc3Qge3N0dWRlbnRTcGVjaWZpY30gPSByZXEuYm9keTtcclxuICAgICAgICBsZXQgc3R1ZGVudElkID0gdXNlci5zdHVkZW50Ly9jb250YWlucyBzdHVkZW50IGlkXHJcbiAgICAgICAgaWYoIXN0dWRlbnRJZCl7Ly9uZXcgdHV0b3JcclxuICAgICAgICAgIHN0dWRlbnRJZCA9IHV1aWR2NCgpXHJcbiAgICAgICAgICBjb25zdCBuZXdTdHVkZW50ID0gbmV3IFN0dWRlbnQoe19pZDogc3R1ZGVudElkLCBzdHVkZW50U3BlY2lmaWN9KVxyXG4gICAgICAgICAgYXdhaXQgbmV3U3R1ZGVudC5zYXZlKCk7XHJcbiAgICAgICAgICB1cGRhdGVzLnN0dWRlbnQgPSBzdHVkZW50SWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICBjb25zdCB1cGRhdGVkU3R1ZGVudCA9IGF3YWl0IFN0dWRlbnQuZmluZEJ5SWRBbmRVcGRhdGUoc3R1ZGVudElkLCB7c3R1ZGVudFNwZWNpZmljfSwge1xyXG4gICAgICAgICAgICBuZXc6IHRydWUsXHJcbiAgICAgICAgICAgIHJ1blZhbGlkYXRvcnM6IHRydWUsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgVXNlci5maW5kQnlJZEFuZFVwZGF0ZShpZCwgdXBkYXRlcywge1xyXG4gICAgICAgIG5ldzogdHJ1ZSxcclxuICAgICAgICBydW5WYWxpZGF0b3JzOiB0cnVlLFxyXG4gICAgICB9KS5wb3B1bGF0ZShcInR1dG9yXCIpLnBvcHVsYXRlKFwic3R1ZGVudFwiKTtcclxuXHJcbiAgICAgIHBheWxvYWQgPSB7dXNlciA6IHVwZGF0ZWRVc2VyfVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIC8vY29uc29sZS5sb2coZXJyKVxyXG4gICAgICByZXR1cm4gbmV4dChlcnIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXMuanNvbihwYXlsb2FkKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBEZWxldGUgYSB1c2VyIGluIHRoZSBkYXRhYmFzZSBieSBpZC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UmVxdWVzdH0gcmVxXHJcbiAgICogQHBhcmFtIHtSZXNwb25zZX0gcmVzXHJcbiAgICovXHJcbiAgYXN5bmMgZGVsZXRlVXNlcihyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgbGV0IHBheWxvYWQgPSB7fTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICAgICAgY29uc3QgZGVsZXRlZFVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kRGVsZXRlKGlkKTtcclxuXHJcbiAgICAgIGlmICghZGVsZXRlZFVzZXIpIHRocm93IG5ldyBBcHBsaWNhdGlvbkVycm9yKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kLicsIHN0YXR1c0NvZGU6IDQwNCB9KTtcclxuXHJcbiAgICAgIGlmKGRlbGV0ZWRVc2VyLnR1dG9yKXtcclxuICAgICAgICBjb25zdCB0dXRvcklkID0gZGVsZXRlZFVzZXIudHV0b3I7XHJcbiAgICAgICAgYXdhaXQgVHV0b3IuZmluZEJ5SWRBbmREZWxldGUodHV0b3JJZCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYoZGVsZXRlZFVzZXIuc3R1ZGVudCl7ICAgICAgICBcclxuICAgICAgICBjb25zdCBzdHVkZW50SWQgPSBkZWxldGVkVXNlci50dXRvcjtcclxuICAgICAgICBhd2FpdCBTdHVkZW50LmZpbmRCeUlkQW5kRGVsZXRlKHN0dWRlbnRJZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHBheWxvYWQgPSB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAvL2NvbnNvbGUubG9nKGVycilcclxuICAgICAgcmV0dXJuIG5leHQoZXJyKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzLmpzb24ocGF5bG9hZCk7XHJcbiAgfSxcclxufTtcclxuIl19